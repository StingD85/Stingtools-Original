<Window x:Class="StingBIM.AI.UI.Panels.ChatPanel"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:controls="clr-namespace:StingBIM.AI.UI.Controls"
        Title="StingBIM AI Assistant"
        Width="400" Height="700"
        MinWidth="320" MinHeight="500"
        Background="{DynamicResource BackgroundBrush}"
        WindowStyle="ToolWindow"
        ShowInTaskbar="False">

    <Window.Resources>
        <ResourceDictionary>
            <ResourceDictionary.MergedDictionaries>
                <ResourceDictionary Source="../Themes/AITheme.xaml"/>
            </ResourceDictionary.MergedDictionaries>
            <BooleanToVisibilityConverter x:Key="BoolToVis"/>
        </ResourceDictionary>
    </Window.Resources>

    <Grid>
        <Grid.RowDefinitions>
            <!-- Header -->
            <RowDefinition Height="Auto"/>
            <!-- Chat Messages -->
            <RowDefinition Height="*"/>
            <!-- Quick Actions Panel -->
            <RowDefinition Height="Auto"/>
            <!-- Input Area -->
            <RowDefinition Height="Auto"/>
            <!-- Status Bar -->
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- ═══════════════════ HEADER BAR ═══════════════════ -->
        <Border Grid.Row="0"
                Background="{DynamicResource HeaderBrush}"
                Padding="12,8">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <!-- AI Icon -->
                <Ellipse Grid.Column="0" Width="32" Height="32"
                         Fill="{DynamicResource AccentBrush}">
                    <Ellipse.Effect>
                        <DropShadowEffect Color="{DynamicResource AccentColor}"
                                          BlurRadius="8" ShadowDepth="0" Opacity="0.5"/>
                    </Ellipse.Effect>
                </Ellipse>
                <TextBlock Grid.Column="0" Text="AI"
                           Foreground="White" FontWeight="Bold" FontSize="12"
                           HorizontalAlignment="Center" VerticalAlignment="Center"/>

                <!-- Title and Status -->
                <StackPanel Grid.Column="1" Margin="12,0,0,0" VerticalAlignment="Center">
                    <TextBlock Text="StingBIM AI Assistant"
                               FontWeight="SemiBold" FontSize="14"
                               Foreground="{DynamicResource ForegroundBrush}"/>
                    <TextBlock x:Name="StatusText" Text="Ready"
                               FontSize="11" Opacity="0.7"
                               Foreground="{DynamicResource ForegroundBrush}"/>
                </StackPanel>

                <!-- Quick Actions Button -->
                <Button Grid.Column="2" x:Name="QuickActionsButton"
                        Style="{DynamicResource IconButtonStyle}"
                        Click="QuickActionsButton_Click"
                        ToolTip="Quick Actions (Ctrl+Q)"
                        Margin="0,0,4,0">
                    <Path Data="M12,2A10,10 0 0,1 22,12A10,10 0 0,1 12,22A10,10 0 0,1 2,12A10,10 0 0,1 12,2M12,4A8,8 0 0,0 4,12A8,8 0 0,0 12,20A8,8 0 0,0 20,12A8,8 0 0,0 12,4M13,10V6H11V10H7V12H11V16H13V12H17V10H13Z"
                          Fill="{DynamicResource ForegroundBrush}"
                          Width="18" Height="18" Stretch="Uniform"/>
                </Button>

                <!-- Settings Button -->
                <Button Grid.Column="3" x:Name="SettingsButton"
                        Style="{DynamicResource IconButtonStyle}"
                        Click="SettingsButton_Click"
                        ToolTip="Settings (Ctrl+S)">
                    <Path Data="M12,15.5A3.5,3.5 0 0,1 8.5,12A3.5,3.5 0 0,1 12,8.5A3.5,3.5 0 0,1 15.5,12A3.5,3.5 0 0,1 12,15.5M19.43,12.97C19.47,12.65 19.5,12.33 19.5,12C19.5,11.67 19.47,11.34 19.43,11L21.54,9.37C21.73,9.22 21.78,8.95 21.66,8.73L19.66,5.27C19.54,5.05 19.27,4.96 19.05,5.05L16.56,6.05C16.04,5.66 15.5,5.32 14.87,5.07L14.5,2.42C14.46,2.18 14.25,2 14,2H10C9.75,2 9.54,2.18 9.5,2.42L9.13,5.07C8.5,5.32 7.96,5.66 7.44,6.05L4.95,5.05C4.73,4.96 4.46,5.05 4.34,5.27L2.34,8.73C2.21,8.95 2.27,9.22 2.46,9.37L4.57,11C4.53,11.34 4.5,11.67 4.5,12C4.5,12.33 4.53,12.65 4.57,12.97L2.46,14.63C2.27,14.78 2.21,15.05 2.34,15.27L4.34,18.73C4.46,18.95 4.73,19.03 4.95,18.95L7.44,17.94C7.96,18.34 8.5,18.68 9.13,18.93L9.5,21.58C9.54,21.82 9.75,22 10,22H14C14.25,22 14.46,21.82 14.5,21.58L14.87,18.93C15.5,18.67 16.04,18.34 16.56,17.94L19.05,18.95C19.27,19.03 19.54,18.95 19.66,18.73L21.66,15.27C21.78,15.05 21.73,14.78 21.54,14.63L19.43,12.97Z"
                          Fill="{DynamicResource ForegroundBrush}"
                          Width="18" Height="18" Stretch="Uniform"/>
                </Button>
            </Grid>
        </Border>

        <!-- ═══════════════════ CHAT MESSAGES ═══════════════════ -->
        <ScrollViewer Grid.Row="1"
                      x:Name="MessagesScrollViewer"
                      VerticalScrollBarVisibility="Auto"
                      HorizontalScrollBarVisibility="Disabled"
                      Padding="8">
            <ItemsControl x:Name="MessagesContainer">
                <ItemsControl.ItemsPanel>
                    <ItemsPanelTemplate>
                        <StackPanel/>
                    </ItemsPanelTemplate>
                </ItemsControl.ItemsPanel>
                <ItemsControl.ItemTemplate>
                    <DataTemplate>
                        <Border Margin="4,4,4,4" Padding="10,8" CornerRadius="12"
                                MaxWidth="380">
                            <Border.Style>
                                <Style TargetType="Border">
                                    <Setter Property="Background" Value="#3A3A3C"/>
                                    <Setter Property="HorizontalAlignment" Value="Left"/>
                                    <Style.Triggers>
                                        <DataTrigger Binding="{Binding IsUser}" Value="True">
                                            <Setter Property="Background" Value="#4A90D9"/>
                                            <Setter Property="HorizontalAlignment" Value="Right"/>
                                        </DataTrigger>
                                        <DataTrigger Binding="{Binding IsError}" Value="True">
                                            <Setter Property="Background" Value="#3D2020"/>
                                            <Setter Property="HorizontalAlignment" Value="Left"/>
                                        </DataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </Border.Style>
                            <StackPanel>
                                <!-- Main message text -->
                                <TextBlock Text="{Binding Text}" TextWrapping="Wrap"
                                           Foreground="White" FontSize="13"/>

                                <!-- Expandable detail sections (BOQ, materials, parameters) -->
                                <ItemsControl ItemsSource="{Binding DetailSections}"
                                              Margin="0,6,0,0">
                                    <ItemsControl.ItemTemplate>
                                        <DataTemplate>
                                            <Border Margin="0,3,0,0" Padding="6,4"
                                                    CornerRadius="6"
                                                    Background="#2A2A2C"
                                                    BorderBrush="#555" BorderThickness="0.5">
                                                <StackPanel>
                                                    <!-- Clickable header to expand/collapse -->
                                                    <Button Click="DetailSection_Click"
                                                            Cursor="Hand"
                                                            Background="Transparent"
                                                            BorderThickness="0"
                                                            HorizontalContentAlignment="Left"
                                                            Padding="0">
                                                        <StackPanel Orientation="Horizontal">
                                                            <TextBlock Text="{Binding ExpandIcon}"
                                                                       Foreground="#4A90D9"
                                                                       FontSize="10"
                                                                       VerticalAlignment="Center"
                                                                       Margin="0,0,6,0"/>
                                                            <TextBlock Text="{Binding Header}"
                                                                       Foreground="#E0E0E0"
                                                                       FontWeight="SemiBold"
                                                                       FontSize="12"/>
                                                            <TextBlock Text="{Binding Summary}"
                                                                       Foreground="#A0A0A0"
                                                                       FontSize="11"
                                                                       Margin="8,0,0,0"
                                                                       VerticalAlignment="Center"/>
                                                        </StackPanel>
                                                    </Button>

                                                    <!-- Detail items (visible when expanded) -->
                                                    <ItemsControl ItemsSource="{Binding Items}"
                                                                  Margin="16,4,0,0"
                                                                  Visibility="{Binding IsExpanded, Converter={StaticResource BoolToVisibilityConverter}}">
                                                        <ItemsControl.ItemTemplate>
                                                            <DataTemplate>
                                                                <StackPanel Margin="0,2,0,0">
                                                                    <StackPanel Orientation="Horizontal">
                                                                        <TextBlock Text="{Binding Label}"
                                                                                   Foreground="#CCC"
                                                                                   FontSize="11.5"
                                                                                   MinWidth="140"/>
                                                                        <TextBlock Text="{Binding Value}"
                                                                                   Foreground="White"
                                                                                   FontSize="11.5"
                                                                                   FontWeight="SemiBold"/>
                                                                        <TextBlock Text="{Binding Unit}"
                                                                                   Foreground="#888"
                                                                                   FontSize="11"
                                                                                   Margin="4,0,0,0"/>
                                                                    </StackPanel>
                                                                    <!-- Sub-items for nested detail -->
                                                                    <ItemsControl ItemsSource="{Binding SubItems}"
                                                                                  Margin="16,0,0,0"
                                                                                  Visibility="{Binding HasSubItems, Converter={StaticResource BoolToVisibilityConverter}}">
                                                                        <ItemsControl.ItemTemplate>
                                                                            <DataTemplate>
                                                                                <StackPanel Orientation="Horizontal" Margin="0,1,0,0">
                                                                                    <TextBlock Text="  - " Foreground="#666" FontSize="11"/>
                                                                                    <TextBlock Text="{Binding Label}" Foreground="#AAA" FontSize="11" MinWidth="120"/>
                                                                                    <TextBlock Text="{Binding Value}" Foreground="#CCC" FontSize="11"/>
                                                                                    <TextBlock Text="{Binding Unit}" Foreground="#777" FontSize="10" Margin="4,0,0,0"/>
                                                                                </StackPanel>
                                                                            </DataTemplate>
                                                                        </ItemsControl.ItemTemplate>
                                                                    </ItemsControl>
                                                                </StackPanel>
                                                            </DataTemplate>
                                                        </ItemsControl.ItemTemplate>
                                                    </ItemsControl>
                                                </StackPanel>
                                            </Border>
                                        </DataTemplate>
                                    </ItemsControl.ItemTemplate>
                                </ItemsControl>

                                <!-- Timestamp -->
                                <TextBlock Text="{Binding Timestamp, StringFormat='{}{0:HH:mm}'}"
                                           FontSize="10" Opacity="0.5" Foreground="White"
                                           HorizontalAlignment="Right" Margin="0,4,0,0"/>
                            </StackPanel>
                        </Border>
                    </DataTemplate>
                </ItemsControl.ItemTemplate>
                <!-- Ensure items stretch to full width for responsive text wrapping -->
                <ItemsControl.ItemContainerStyle>
                    <Style TargetType="ContentPresenter">
                        <Setter Property="HorizontalAlignment" Value="Stretch"/>
                    </Style>
                </ItemsControl.ItemContainerStyle>
            </ItemsControl>
        </ScrollViewer>

        <!-- ═══════════════════ QUICK ACTIONS PANEL ═══════════════════ -->
        <Border Grid.Row="2" x:Name="QuickActionsBorder"
                Style="{DynamicResource QuickActionsPanelStyle}"
                Visibility="Visible">
            <ScrollViewer VerticalScrollBarVisibility="Auto"
                          HorizontalScrollBarVisibility="Disabled"
                          MaxHeight="260">
                <StackPanel x:Name="QuickActionsStack">

                    <!-- ── Model Analysis ── -->
                    <ToggleButton x:Name="CategoryAnalysis" IsChecked="True"
                                  Style="{DynamicResource CategoryToggleStyle}"
                                  Content="MODEL ANALYSIS"
                                  Click="CategoryToggle_Click"/>
                    <WrapPanel x:Name="AnalysisButtons" Margin="0,0,0,2">
                        <Button Content="Model Summary" Style="{DynamicResource CommandButtonStyle}" Click="QuickAction_Click"/>
                        <Button Content="Count Elements" Style="{DynamicResource CommandButtonStyle}" Click="QuickAction_Click"/>
                        <Button Content="Check Health" Style="{DynamicResource CommandButtonStyle}" Click="QuickAction_Click"/>
                        <Button Content="Room Areas" Style="{DynamicResource CommandButtonStyle}" Click="QuickAction_Click"/>
                        <Button Content="Element Properties" Style="{DynamicResource CommandButtonStyle}" Click="QuickAction_Click"/>
                        <Button Content="Spatial Analysis" Style="{DynamicResource CommandButtonStyle}" Click="QuickAction_Click"/>
                    </WrapPanel>

                    <!-- ── Quality & Compliance ── -->
                    <ToggleButton x:Name="CategoryCompliance" IsChecked="True"
                                  Style="{DynamicResource CategoryToggleStyle}"
                                  Content="QUALITY &amp; COMPLIANCE"
                                  Click="CategoryToggle_Click"/>
                    <WrapPanel x:Name="ComplianceButtons" Margin="0,0,0,2">
                        <Button Content="Quality Check" Style="{DynamicResource CommandButtonStyle}" Click="QuickAction_Click"/>
                        <Button Content="Code Compliance" Style="{DynamicResource CommandButtonStyle}" Click="QuickAction_Click"/>
                        <Button Content="Fire Safety" Style="{DynamicResource CommandButtonStyle}" Click="QuickAction_Click"/>
                        <Button Content="Accessibility" Style="{DynamicResource CommandButtonStyle}" Click="QuickAction_Click"/>
                        <Button Content="MEP Compliance" Style="{DynamicResource CommandButtonStyle}" Click="QuickAction_Click"/>
                        <Button Content="Structural Check" Style="{DynamicResource CommandButtonStyle}" Click="QuickAction_Click"/>
                    </WrapPanel>

                    <!-- ── Design & Creation ── -->
                    <ToggleButton x:Name="CategoryDesign" IsChecked="True"
                                  Style="{DynamicResource CategoryToggleStyle}"
                                  Content="DESIGN &amp; CREATION"
                                  Click="CategoryToggle_Click"/>
                    <WrapPanel x:Name="DesignButtons" Margin="0,0,0,2">
                        <Button Content="Create Wall" Style="{DynamicResource CommandButtonStyle}" Click="QuickAction_Click"/>
                        <Button Content="Create Room" Style="{DynamicResource CommandButtonStyle}" Click="QuickAction_Click"/>
                        <Button Content="Create Floor" Style="{DynamicResource CommandButtonStyle}" Click="QuickAction_Click"/>
                        <Button Content="Add Window" Style="{DynamicResource CommandButtonStyle}" Click="QuickAction_Click"/>
                        <Button Content="Add Door" Style="{DynamicResource CommandButtonStyle}" Click="QuickAction_Click"/>
                        <Button Content="Generate Layout" Style="{DynamicResource CommandButtonStyle}" Click="QuickAction_Click"/>
                        <Button Content="Design Variants" Style="{DynamicResource CommandButtonStyle}" Click="QuickAction_Click"/>
                    </WrapPanel>

                    <!-- ── Multi-Agent Review ── -->
                    <ToggleButton x:Name="CategoryReview" IsChecked="True"
                                  Style="{DynamicResource CategoryToggleStyle}"
                                  Content="MULTI-AGENT REVIEW"
                                  Click="CategoryToggle_Click"/>
                    <WrapPanel x:Name="ReviewButtons" Margin="0,0,0,2">
                        <Button Content="Design Review" Style="{DynamicResource CommandButtonStyle}" Click="QuickAction_Click"/>
                        <Button Content="Architectural" Style="{DynamicResource CommandButtonStyle}" Click="QuickAction_Click"/>
                        <Button Content="Structural" Style="{DynamicResource CommandButtonStyle}" Click="QuickAction_Click"/>
                        <Button Content="MEP Review" Style="{DynamicResource CommandButtonStyle}" Click="QuickAction_Click"/>
                        <Button Content="Cost Analysis" Style="{DynamicResource CommandButtonStyle}" Click="QuickAction_Click"/>
                        <Button Content="Safety Review" Style="{DynamicResource CommandButtonStyle}" Click="QuickAction_Click"/>
                        <Button Content="Sustainability" Style="{DynamicResource CommandButtonStyle}" Click="QuickAction_Click"/>
                    </WrapPanel>

                    <!-- ── Coordination ── -->
                    <ToggleButton x:Name="CategoryCoordination" IsChecked="True"
                                  Style="{DynamicResource CategoryToggleStyle}"
                                  Content="COORDINATION"
                                  Click="CategoryToggle_Click"/>
                    <WrapPanel x:Name="CoordinationButtons" Margin="0,0,0,2">
                        <Button Content="Detect Clashes" Style="{DynamicResource CommandButtonStyle}" Click="QuickAction_Click"/>
                        <Button Content="Auto-Resolve Clashes" Style="{DynamicResource CommandButtonStyle}" Click="QuickAction_Click"/>
                        <Button Content="Check Clearances" Style="{DynamicResource CommandButtonStyle}" Click="QuickAction_Click"/>
                        <Button Content="Coordination Report" Style="{DynamicResource CommandButtonStyle}" Click="QuickAction_Click"/>
                    </WrapPanel>

                    <!-- ── Automation ── -->
                    <ToggleButton x:Name="CategoryAutomation" IsChecked="True"
                                  Style="{DynamicResource CategoryToggleStyle}"
                                  Content="AUTOMATION"
                                  Click="CategoryToggle_Click"/>
                    <WrapPanel x:Name="AutomationButtons" Margin="0,0,0,2">
                        <Button Content="Generate Schedules" Style="{DynamicResource CommandButtonStyle}" Click="QuickAction_Click"/>
                        <Button Content="Auto-Populate Params" Style="{DynamicResource CommandButtonStyle}" Click="QuickAction_Click"/>
                        <Button Content="Sync Families" Style="{DynamicResource CommandButtonStyle}" Click="QuickAction_Click"/>
                        <Button Content="Batch Parameters" Style="{DynamicResource CommandButtonStyle}" Click="QuickAction_Click"/>
                        <Button Content="Export Parameters" Style="{DynamicResource CommandButtonStyle}" Click="QuickAction_Click"/>
                        <Button Content="Import Parameters" Style="{DynamicResource CommandButtonStyle}" Click="QuickAction_Click"/>
                    </WrapPanel>

                    <!-- ── Maintenance & Facilities ── -->
                    <ToggleButton x:Name="CategoryMaintenance" IsChecked="True"
                                  Style="{DynamicResource CategoryToggleStyle}"
                                  Content="MAINTENANCE &amp; FACILITIES"
                                  Click="CategoryToggle_Click"/>
                    <WrapPanel x:Name="MaintenanceButtons" Margin="0,0,0,2">
                        <Button Content="Maintenance Schedule" Style="{DynamicResource CommandButtonStyle}" Click="QuickAction_Click"/>
                        <Button Content="Predict Failures" Style="{DynamicResource CommandButtonStyle}" Click="QuickAction_Click"/>
                        <Button Content="Equipment Analysis" Style="{DynamicResource CommandButtonStyle}" Click="QuickAction_Click"/>
                        <Button Content="Register Assets" Style="{DynamicResource CommandButtonStyle}" Click="QuickAction_Click"/>
                        <Button Content="Assets Attention" Style="{DynamicResource CommandButtonStyle}" Click="QuickAction_Click"/>
                        <Button Content="Capital Forecast" Style="{DynamicResource CommandButtonStyle}" Click="QuickAction_Click"/>
                        <Button Content="Work Orders" Style="{DynamicResource CommandButtonStyle}" Click="QuickAction_Click"/>
                    </WrapPanel>

                    <!-- ── Reports & Analytics ── -->
                    <ToggleButton x:Name="CategoryReports" IsChecked="True"
                                  Style="{DynamicResource CategoryToggleStyle}"
                                  Content="REPORTS &amp; ANALYTICS"
                                  Click="CategoryToggle_Click"/>
                    <WrapPanel x:Name="ReportsButtons" Margin="0,0,0,2">
                        <Button Content="QA Report" Style="{DynamicResource CommandButtonStyle}" Click="QuickAction_Click"/>
                        <Button Content="Energy Analysis" Style="{DynamicResource CommandButtonStyle}" Click="QuickAction_Click"/>
                        <Button Content="Cost Estimate" Style="{DynamicResource CommandButtonStyle}" Click="QuickAction_Click"/>
                        <Button Content="Design Optimization" Style="{DynamicResource CommandButtonStyle}" Click="QuickAction_Click"/>
                        <Button Content="Construction Sequence" Style="{DynamicResource CommandButtonStyle}" Click="QuickAction_Click"/>
                        <Button Content="Quantity Takeoff" Style="{DynamicResource CommandButtonStyle}" Click="QuickAction_Click"/>
                        <Button Content="Portfolio Analytics" Style="{DynamicResource CommandButtonStyle}" Click="QuickAction_Click"/>
                    </WrapPanel>

                    <!-- ── Help ── -->
                    <ToggleButton x:Name="CategoryHelp" IsChecked="True"
                                  Style="{DynamicResource CategoryToggleStyle}"
                                  Content="HELP"
                                  Click="CategoryToggle_Click"/>
                    <WrapPanel x:Name="HelpButtons" Margin="0,0,0,2">
                        <Button Content="Help" Style="{DynamicResource CommandButtonStyle}" Click="QuickAction_Click"/>
                        <Button Content="List Commands" Style="{DynamicResource CommandButtonStyle}" Click="QuickAction_Click"/>
                        <Button Content="Keyboard Shortcuts" Style="{DynamicResource CommandButtonStyle}" Click="QuickAction_Click"/>
                        <Button Content="About" Style="{DynamicResource CommandButtonStyle}" Click="QuickAction_Click"/>
                    </WrapPanel>

                </StackPanel>
            </ScrollViewer>
        </Border>

        <!-- ═══════════════════ INPUT AREA ═══════════════════ -->
        <Border Grid.Row="3"
                Background="{DynamicResource InputBackgroundBrush}"
                BorderBrush="{DynamicResource BorderBrush}"
                BorderThickness="0,1,0,0"
                Padding="8">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <!-- Voice Button -->
                <Button Grid.Column="0" x:Name="VoiceButton"
                        Style="{DynamicResource VoiceButtonStyle}"
                        Click="VoiceButton_Click"
                        ToolTip="Voice input (hold to speak)">
                    <Grid>
                        <!-- Microphone Icon -->
                        <Path x:Name="MicIcon"
                              Data="M12,2A3,3 0 0,1 15,5V11A3,3 0 0,1 12,14A3,3 0 0,1 9,11V5A3,3 0 0,1 12,2M19,11C19,14.53 16.39,17.44 13,17.93V21H11V17.93C7.61,17.44 5,14.53 5,11H7A5,5 0 0,0 12,16A5,5 0 0,0 17,11H19Z"
                              Fill="{DynamicResource ForegroundBrush}"
                              Width="20" Height="20" Stretch="Uniform"/>
                        <!-- Voice Indicator (pulsing when active) -->
                        <Ellipse x:Name="VoiceIndicator"
                                 Width="24" Height="24"
                                 Fill="{DynamicResource AccentBrush}"
                                 Opacity="0"
                                 Visibility="Collapsed"/>
                    </Grid>
                </Button>

                <!-- Text Input -->
                <Border Grid.Column="1"
                        Background="{DynamicResource TextBoxBackgroundBrush}"
                        CornerRadius="18"
                        Margin="8,0">
                    <Grid>
                        <TextBox x:Name="InputTextBox"
                                 Style="{DynamicResource ChatInputStyle}"
                                 Text=""
                                 AcceptsReturn="False"
                                 TextWrapping="Wrap"
                                 MaxLines="4"
                                 VerticalContentAlignment="Center"
                                 KeyDown="InputTextBox_KeyDown"/>
                        <TextBlock x:Name="PlaceholderText"
                                   Text="Type a message..."
                                   IsHitTestVisible="False"
                                   Foreground="{DynamicResource PlaceholderBrush}"
                                   VerticalAlignment="Center"
                                   Margin="16,0"
                                   Visibility="Visible"/>
                    </Grid>
                </Border>

                <!-- Send Button -->
                <Button Grid.Column="2" x:Name="SendButton"
                        Style="{DynamicResource SendButtonStyle}"
                        Click="SendButton_Click"
                        IsEnabled="False"
                        ToolTip="Send message">
                    <Path Data="M2,21L23,12L2,3V10L17,12L2,14V21Z"
                          Fill="White"
                          Width="18" Height="18" Stretch="Uniform"/>
                </Button>
            </Grid>
        </Border>

        <!-- ═══════════════════ STATUS BAR ═══════════════════ -->
        <Border Grid.Row="4" Style="{DynamicResource StatusBarStyle}">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>
                <TextBlock Grid.Column="0" x:Name="StatusBarVersion"
                           Text="StingBIM AI v7.0"
                           FontSize="10" Opacity="0.5"
                           Foreground="{DynamicResource ForegroundBrush}"/>
                <TextBlock Grid.Column="1" x:Name="StatusBarTime"
                           Text=""
                           FontSize="10" Opacity="0.5"
                           Foreground="{DynamicResource ForegroundBrush}"/>
            </Grid>
        </Border>

        <!-- ═══════════════════ LOADING OVERLAY ═══════════════════ -->
        <Border Grid.RowSpan="5" x:Name="LoadingOverlay"
                Background="#80000000"
                Visibility="Collapsed">
            <StackPanel VerticalAlignment="Center" HorizontalAlignment="Center">
                <controls:ProgressIndicator x:Name="LoadingIndicator"
                                            IsActive="True"
                                            Width="48" Height="48"/>
                <TextBlock x:Name="LoadingText" Text="Processing..."
                           Foreground="White" FontSize="14"
                           HorizontalAlignment="Center"
                           Margin="0,12,0,0"/>
            </StackPanel>
        </Border>

        <!-- Quick Actions Popup -->
        <Popup x:Name="QuickActionsPopup"
               PlacementTarget="{Binding ElementName=QuickActionsButton}"
               Placement="Bottom"
               StaysOpen="False"
               AllowsTransparency="True"
               PopupAnimation="Fade">
            <controls:QuickActionsPanel x:Name="QuickActionsPopupPanel"
                                        ActionSelected="QuickActionsPanel_ActionSelected"
                                        CloseRequested="QuickActionsPanel_CloseRequested"/>
        </Popup>

        <!-- Notification Host -->
        <controls:NotificationHost Grid.RowSpan="4"
                                   x:Name="NotificationHost"
                                   Position="TopRight"/>
    </Grid>
</Window>

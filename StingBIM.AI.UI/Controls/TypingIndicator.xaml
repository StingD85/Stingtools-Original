<UserControl x:Class="StingBIM.AI.UI.Controls.TypingIndicator"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             x:Name="Root"
             Height="40">

    <UserControl.Resources>
        <!-- Dot bounce animation -->
        <Storyboard x:Key="BounceAnimation" RepeatBehavior="Forever">
            <!-- Dot 1 -->
            <DoubleAnimationUsingKeyFrames Storyboard.TargetName="Dot1"
                                           Storyboard.TargetProperty="(UIElement.RenderTransform).(TranslateTransform.Y)">
                <EasingDoubleKeyFrame KeyTime="0:0:0" Value="0"/>
                <EasingDoubleKeyFrame KeyTime="0:0:0.15" Value="-6">
                    <EasingDoubleKeyFrame.EasingFunction>
                        <QuadraticEase EasingMode="EaseOut"/>
                    </EasingDoubleKeyFrame.EasingFunction>
                </EasingDoubleKeyFrame>
                <EasingDoubleKeyFrame KeyTime="0:0:0.3" Value="0">
                    <EasingDoubleKeyFrame.EasingFunction>
                        <QuadraticEase EasingMode="EaseIn"/>
                    </EasingDoubleKeyFrame.EasingFunction>
                </EasingDoubleKeyFrame>
                <EasingDoubleKeyFrame KeyTime="0:0:0.9" Value="0"/>
            </DoubleAnimationUsingKeyFrames>

            <!-- Dot 2 -->
            <DoubleAnimationUsingKeyFrames Storyboard.TargetName="Dot2"
                                           Storyboard.TargetProperty="(UIElement.RenderTransform).(TranslateTransform.Y)">
                <EasingDoubleKeyFrame KeyTime="0:0:0.15" Value="0"/>
                <EasingDoubleKeyFrame KeyTime="0:0:0.3" Value="-6">
                    <EasingDoubleKeyFrame.EasingFunction>
                        <QuadraticEase EasingMode="EaseOut"/>
                    </EasingDoubleKeyFrame.EasingFunction>
                </EasingDoubleKeyFrame>
                <EasingDoubleKeyFrame KeyTime="0:0:0.45" Value="0">
                    <EasingDoubleKeyFrame.EasingFunction>
                        <QuadraticEase EasingMode="EaseIn"/>
                    </EasingDoubleKeyFrame.EasingFunction>
                </EasingDoubleKeyFrame>
                <EasingDoubleKeyFrame KeyTime="0:0:0.9" Value="0"/>
            </DoubleAnimationUsingKeyFrames>

            <!-- Dot 3 -->
            <DoubleAnimationUsingKeyFrames Storyboard.TargetName="Dot3"
                                           Storyboard.TargetProperty="(UIElement.RenderTransform).(TranslateTransform.Y)">
                <EasingDoubleKeyFrame KeyTime="0:0:0.3" Value="0"/>
                <EasingDoubleKeyFrame KeyTime="0:0:0.45" Value="-6">
                    <EasingDoubleKeyFrame.EasingFunction>
                        <QuadraticEase EasingMode="EaseOut"/>
                    </EasingDoubleKeyFrame.EasingFunction>
                </EasingDoubleKeyFrame>
                <EasingDoubleKeyFrame KeyTime="0:0:0.6" Value="0">
                    <EasingDoubleKeyFrame.EasingFunction>
                        <QuadraticEase EasingMode="EaseIn"/>
                    </EasingDoubleKeyFrame.EasingFunction>
                </EasingDoubleKeyFrame>
                <EasingDoubleKeyFrame KeyTime="0:0:0.9" Value="0"/>
            </DoubleAnimationUsingKeyFrames>
        </Storyboard>

        <!-- Status text fade animation -->
        <Storyboard x:Key="StatusFadeAnimation" RepeatBehavior="Forever">
            <DoubleAnimation Storyboard.TargetName="StatusText"
                             Storyboard.TargetProperty="Opacity"
                             From="0.6" To="1" Duration="0:0:0.8"
                             AutoReverse="True"/>
        </Storyboard>
    </UserControl.Resources>

    <Border Background="{DynamicResource CardBrush}"
            CornerRadius="12"
            Padding="12,8"
            HorizontalAlignment="Left"
            Margin="8,4">
        <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
            <!-- AI Avatar -->
            <Ellipse Width="24" Height="24"
                     Fill="{DynamicResource AccentBrush}"
                     Margin="0,0,8,0">
                <Ellipse.Effect>
                    <DropShadowEffect Color="{DynamicResource AccentColor}"
                                      BlurRadius="4" ShadowDepth="0" Opacity="0.3"/>
                </Ellipse.Effect>
            </Ellipse>
            <TextBlock Text="AI" Foreground="White" FontWeight="Bold" FontSize="10"
                       HorizontalAlignment="Center" VerticalAlignment="Center"
                       Margin="-32,0,8,0"/>

            <!-- Bouncing dots -->
            <StackPanel Orientation="Horizontal" VerticalAlignment="Center" Margin="4,0">
                <Ellipse x:Name="Dot1" Width="6" Height="6"
                         Fill="{DynamicResource ForegroundSecondaryBrush}"
                         Margin="2,0" RenderTransformOrigin="0.5,0.5">
                    <Ellipse.RenderTransform>
                        <TranslateTransform/>
                    </Ellipse.RenderTransform>
                </Ellipse>
                <Ellipse x:Name="Dot2" Width="6" Height="6"
                         Fill="{DynamicResource ForegroundSecondaryBrush}"
                         Margin="2,0" RenderTransformOrigin="0.5,0.5">
                    <Ellipse.RenderTransform>
                        <TranslateTransform/>
                    </Ellipse.RenderTransform>
                </Ellipse>
                <Ellipse x:Name="Dot3" Width="6" Height="6"
                         Fill="{DynamicResource ForegroundSecondaryBrush}"
                         Margin="2,0" RenderTransformOrigin="0.5,0.5">
                    <Ellipse.RenderTransform>
                        <TranslateTransform/>
                    </Ellipse.RenderTransform>
                </Ellipse>
            </StackPanel>

            <!-- Status text -->
            <TextBlock x:Name="StatusText"
                       Text="{Binding StatusMessage, ElementName=Root, FallbackValue='Thinking...'}"
                       Foreground="{DynamicResource ForegroundSecondaryBrush}"
                       FontSize="12"
                       VerticalAlignment="Center"
                       Margin="8,0,0,0"/>
        </StackPanel>
    </Border>
</UserControl>

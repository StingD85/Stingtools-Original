<UserControl x:Class="StingBIM.AI.UI.Controls.AutocompletePopup"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             x:Name="Root">

    <UserControl.Resources>
        <!-- Suggestion Item Style -->
        <Style x:Key="SuggestionItemStyle" TargetType="ListBoxItem">
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="Padding" Value="10,8"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="ListBoxItem">
                        <Border Background="{TemplateBinding Background}"
                                Padding="{TemplateBinding Padding}">
                            <ContentPresenter/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter Property="Background" Value="{DynamicResource CardBrush}"/>
                            </Trigger>
                            <Trigger Property="IsSelected" Value="True">
                                <Setter Property="Background" Value="{DynamicResource AccentBrush}"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
    </UserControl.Resources>

    <Popup x:Name="SuggestionsPopup"
           AllowsTransparency="True"
           PopupAnimation="Fade"
           StaysOpen="False"
           Placement="Top">
        <Border Background="{DynamicResource SurfaceBrush}"
                BorderBrush="{DynamicResource BorderBrush}"
                BorderThickness="1"
                CornerRadius="8"
                MaxHeight="250"
                MinWidth="200">
            <Border.Effect>
                <DropShadowEffect BlurRadius="12"
                                  ShadowDepth="4"
                                  Direction="270"
                                  Opacity="0.15"/>
            </Border.Effect>

            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>

                <!-- Header -->
                <Border Grid.Row="0"
                        Background="{DynamicResource CardBrush}"
                        CornerRadius="8,8,0,0"
                        Padding="10,6">
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>

                        <Path Grid.Column="0"
                              Data="M9.5,3A6.5,6.5 0 0,1 16,9.5C16,11.11 15.41,12.59 14.44,13.73L14.71,14H15.5L20.5,19L19,20.5L14,15.5V14.71L13.73,14.44C12.59,15.41 11.11,16 9.5,16A6.5,6.5 0 0,1 3,9.5A6.5,6.5 0 0,1 9.5,3M9.5,5C7,5 5,7 5,9.5C5,12 7,14 9.5,14C12,14 14,12 14,9.5C14,7 12,5 9.5,5Z"
                              Fill="{DynamicResource ForegroundSecondaryBrush}"
                              Width="14" Height="14" Stretch="Uniform"
                              Margin="0,0,8,0" VerticalAlignment="Center"/>

                        <TextBlock Grid.Column="1"
                                   x:Name="HeaderText"
                                   Text="Suggestions"
                                   FontSize="11"
                                   FontWeight="Medium"
                                   Foreground="{DynamicResource ForegroundSecondaryBrush}"
                                   VerticalAlignment="Center"/>
                    </Grid>
                </Border>

                <!-- Suggestions List -->
                <ListBox Grid.Row="1"
                         x:Name="SuggestionsList"
                         Background="Transparent"
                         BorderThickness="0"
                         ItemContainerStyle="{StaticResource SuggestionItemStyle}"
                         SelectionChanged="SuggestionsList_SelectionChanged"
                         PreviewKeyDown="SuggestionsList_PreviewKeyDown"
                         ScrollViewer.HorizontalScrollBarVisibility="Disabled">
                    <ListBox.ItemTemplate>
                        <DataTemplate>
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>

                                <!-- Category Icon -->
                                <Border Grid.Column="0"
                                        Width="24" Height="24"
                                        Background="{DynamicResource AccentBrush}"
                                        CornerRadius="4"
                                        Margin="0,0,10,0"
                                        Opacity="0.8">
                                    <Path Data="{Binding IconPath}"
                                          Fill="White"
                                          Width="12" Height="12"
                                          Stretch="Uniform"
                                          HorizontalAlignment="Center"
                                          VerticalAlignment="Center"/>
                                </Border>

                                <!-- Text -->
                                <StackPanel Grid.Column="1" VerticalAlignment="Center">
                                    <TextBlock Text="{Binding DisplayText}"
                                               FontSize="13"
                                               Foreground="{DynamicResource ForegroundBrush}"/>
                                    <TextBlock Text="{Binding Description}"
                                               FontSize="10"
                                               Foreground="{DynamicResource ForegroundSecondaryBrush}"
                                               Visibility="{Binding HasDescription, Converter={StaticResource BoolToVisibilityConverter}}"/>
                                </StackPanel>

                                <!-- Shortcut hint -->
                                <TextBlock Grid.Column="2"
                                           Text="{Binding Shortcut}"
                                           FontSize="10"
                                           Foreground="{DynamicResource ForegroundSecondaryBrush}"
                                           VerticalAlignment="Center"
                                           Visibility="{Binding HasShortcut, Converter={StaticResource BoolToVisibilityConverter}}"/>
                            </Grid>
                        </DataTemplate>
                    </ListBox.ItemTemplate>
                </ListBox>

                <!-- No suggestions message -->
                <TextBlock Grid.Row="1"
                           x:Name="NoSuggestionsText"
                           Text="No suggestions"
                           FontSize="12"
                           Foreground="{DynamicResource ForegroundSecondaryBrush}"
                           HorizontalAlignment="Center"
                           VerticalAlignment="Center"
                           Margin="20"
                           Visibility="Collapsed"/>

                <!-- Keyboard hint -->
                <Border Grid.Row="1"
                        VerticalAlignment="Bottom"
                        HorizontalAlignment="Center"
                        Background="{DynamicResource CardBrush}"
                        CornerRadius="4"
                        Padding="8,4"
                        Margin="0,0,0,8"
                        Opacity="0.8">
                    <TextBlock Text="↑↓ Navigate • Enter Select • Esc Close"
                               FontSize="10"
                               Foreground="{DynamicResource ForegroundSecondaryBrush}"/>
                </Border>
            </Grid>
        </Border>
    </Popup>
</UserControl>
